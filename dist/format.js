window.storyFormat({
  "name": "Twison-ST",
  "version": "0.0.1",
  "author": "Sarganar",
  "description": "Export your Twine 2 story as a JSON document with Meta Data",
  "proofing": false,
  "source": "<html>\r\n\r\n<head>\r\n  <title>{{STORY_NAME}}</title>\r\n  <script type=\"text/javascript\">\r\n    /**\r\n     * Twison - Twine 2 JSON Export Story Format\r\n     *\r\n     * Copyright (c) 2015 Em Walker\r\n     * https://lazerwalker.com\r\n     *\r\n     * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and\r\n     * associated documentation files (the \"Software\"), to deal in the Software without restriction,\r\n     * including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,\r\n     * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so,\r\n     * subject to the following conditions:\r\n     *\r\n     * The above copyright notice and this permission notice shall be included in all copies or substantial\r\n     * portions of the Software.\r\n     *\r\n     * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT\r\n     * LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\r\n     * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\r\n     * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\r\n     * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n     */\r\n    var Twison={extractLinksFromText:function(t){var n=t.match(/\\[\\[.+?\\]\\]/g);return n?{text:t.replace(/\\[\\[.+?\\]\\]/g,\"\").trim(),links:n.map(function(t){var n=t.match(/\\[\\[(.*?)\\-\\&gt;(.*?)\\]\\]/);return n?{text:n[1],link:n[2]}:(t=t.substring(2,t.length-2),{text:t,link:t})})}:{text:t,links:null}},extractPropsFromText:function(t){var n,e={},a=!1;const r=/\\{\\{((\\s|\\S)+?)\\}\\}((\\s|\\S)+?)\\{\\{\\/\\1\\}\\}/gm;for(;null!==(n=r.exec(t));){const o=n[1],s=n[3].replace(/(\\r\\n|\\n|\\r)/gm,\"\"),i=this.extractPropsFromText(s);e[o]=null!==i?i:s,a=!0}return a?e:null},extractMetaDataFromText:function(t){var n,e={},a=!1;const r=/(?<key>[^:]+):(?<value>[^,]+),?(.|[\\r\\n])?/gm;for(;null!==(n=r.exec(t));){const o=n.groups.key,s=n.groups.value;e[o]=s,a=!0}return a?e:null},convertPassage:function(t){var n={text:t.innerHTML},e=Twison.extractLinksFromText(n.text);e.links?n.links=e.links:n.links=[],n.text=e.text;const a=Twison.extractPropsFromText(n.text);if(a&&(n.props=a),[\"name\",\"pid\",\"tags\"].forEach(function(e){var a=t.attributes[e].value;a&&(n[e]=a)}),n.tags&&(n.tags=n.tags.split(\" \")),\"metaData\"===n.name){const r=Twison.extractMetaDataFromText(n.text);r&&(n.metadata=r)}return n},convertStory:function(t){var n=t.getElementsByTagName(\"tw-passagedata\"),e=Array.prototype.slice.call(n).map(Twison.convertPassage),a={passages:e};[\"name\",\"startnode\",\"creator\",\"creator-version\",\"ifid\"].forEach(function(n){var e=t.attributes[n].value;e&&(a[n]=e)});var r={};a.passages.forEach(function(t){r[t.name]=t.pid}),a.passages.forEach(function(t){t.links&&t.links.forEach(function(t){t.pid=r[t.link],t.pid||(t.broken=!0)})});const o=e.filter(function(t){return\"metaData\"===t.name});if(o){const s=o[0].metadata;a=Object.assign(a,s)}return a},convert:function(){var t=document.getElementsByTagName(\"tw-storydata\")[0],n=JSON.stringify(Twison.convertStory(t),null,2);document.getElementById(\"output\").innerHTML=n}};window.Twison=Twison;\r\n  </script>\r\n</head>\r\n\r\n<body>\r\n  <button onclick=\"CopyToClipboard('output')\">COPY JSON TO CLIPBOARD</button>\r\n  <pre id=\"output\"></pre>\r\n  <div id=\"storyData\" style=\"display: none;\">\r\n    {{STORY_DATA}}\r\n  </div>\r\n  <script>\r\n    Twison.convert();\r\n    function CopyToClipboard(containerid) {\r\n      if (document.selection) {\r\n        var range = document.body.createTextRange();\r\n        range.moveToElementText(document.getElementById(containerid));\r\n        range.select().createTextRange();\r\n        document.execCommand(\"copy\");\r\n      } else if (window.getSelection) {\r\n        var range = document.createRange();\r\n        range.selectNode(document.getElementById(containerid));\r\n        window.getSelection().addRange(range);\r\n        document.execCommand(\"copy\");\r\n        alert(\"Text has been copied!\")\r\n      }\r\n      document.getSelection().removeAllRanges();\r\n    }\r\n  </script>\r\n</body>\r\n\r\n</html>"
});